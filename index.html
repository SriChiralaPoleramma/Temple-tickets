<!DOCTYPE html>
<html lang="te">
<head>
<meta charset="UTF-8">
<title>‡∞∂‡±ç‡∞∞‡±Ä ‡∞™‡±ã‡∞≤‡±á‡∞∞‡∞Æ‡±ç‡∞Æ ‡∞§‡∞≤‡±ç‡∞≤‡∞ø | Digital Seva Portal</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Icons & Libraries -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

<style>
/* ---------- BASIC THEME ---------- */
body{
  font-family:Poppins, sans-serif;
  background:#fff7ea;
  margin:0;
}

/* ---------- CARD ---------- */
.card{
  max-width:420px;
  margin:30px auto;
  background:white;
  border-radius:30px;
  padding:30px;
  box-shadow:0 20px 40px rgba(0,0,0,.15);
}

/* ---------- HEADERS ---------- */
.om{
  font-size:50px;
  text-align:center;
  color:#8e0000;
}
h1{
  text-align:center;
  color:#8e0000;
  margin-bottom:10px;
}

/* ---------- INPUTS ---------- */
input,button{
  width:100%;
  padding:14px;
  margin-top:12px;
  border-radius:14px;
  border:1px solid #ccc;
  font-size:15px;
}
button{
  background:#8e0000;
  color:white;
  border:none;
  font-weight:700;
  cursor:pointer;
}

/* ---------- RECEIPT ---------- */
#ticket{display:none;text-align:center}
#qr{margin-top:20px}
</style>
</head>

<body>

<!-- ================= FORM ================= -->
<div class="card" id="formCard">
  <div class="om">‡•ê</div>
  <h1>‡∞∂‡±ç‡∞∞‡±Ä ‡∞™‡±ã‡∞≤‡±á‡∞∞‡∞Æ‡±ç‡∞Æ ‡∞§‡∞≤‡±ç‡∞≤‡∞ø</h1>

  <input id="name" placeholder="‡∞≠‡∞ï‡±ç‡∞§‡±Å‡∞®‡∞ø ‡∞™‡±á‡∞∞‡±Å">
  <input id="mobile" placeholder="‡∞Æ‡±ä‡∞¨‡±à‡∞≤‡±ç ‡∞®‡∞Ç‡∞¨‡∞∞‡±ç">
  <input id="goth" placeholder="‡∞ó‡±ã‡∞§‡±ç‡∞∞‡∞Ç">
  <input type="date" id="start">
  <input type="date" id="end">

  <button onclick="generateTicket()">‡∞∏‡±á‡∞µ ‡∞∞‡∞∏‡±Ä‡∞¶‡±Å ‡∞∏‡±É‡∞∑‡±ç‡∞ü‡∞ø‡∞Ç‡∞ö‡±Å</button>
</div>

<!-- ================= RECEIPT ================= -->
<div class="card" id="ticket">
  <div id="capture">
    <div class="om">‡•ê</div>
    <h1>‡∞¶‡±à‡∞µ ‡∞∏‡±á‡∞µ ‡∞∞‡∞∏‡±Ä‡∞¶‡±Å</h1>
    <p id="details"></p>
    <div id="qr"></div>
  </div>

  <button onclick="saveImage()">üì• Save Image</button>
  <button onclick="shareWhatsApp()">üì≤ WhatsApp Share</button>
</div>

<script>
/**************************************************
 * CONFIG
 **************************************************/
const SCRIPT_URL = "PASTE_YOUR_APPS_SCRIPT_WEBAPP_URL";

/**************************************************
 * Generate Ticket
 **************************************************/
async function generateTicket(){
  if(!name.value || !mobile.value || !start.value || !end.value){
    Swal.fire("‡∞Ö‡∞®‡±ç‡∞®‡∞ø ‡∞µ‡∞ø‡∞µ‡∞∞‡∞æ‡∞≤‡±Å ‡∞®‡∞Æ‡±ã‡∞¶‡±Å ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø");
    return;
  }

  const ticketId = "POL-" + Math.random().toString(36).substr(2,6).toUpperCase();
  const verifyURL = location.origin + location.pathname + "?id=" + ticketId;

  // Prepare data
  const fd = new FormData();
  fd.append("ticket_id", ticketId);
  fd.append("dev_name", name.value);
  fd.append("dev_mobile", mobile.value);
  fd.append("dev_goth", goth.value);
  fd.append("start_date", start.value);
  fd.append("end_date", end.value);
  fd.append("verify_url", verifyURL);

  Swal.fire({title:"‡∞∏‡±á‡∞µ ‡∞®‡∞Æ‡±ã‡∞¶‡±Å ‡∞Ö‡∞µ‡±Å‡∞§‡±ã‡∞Ç‡∞¶‡∞ø...",allowOutsideClick:false,didOpen:()=>Swal.showLoading()});

  const res = await fetch(SCRIPT_URL,{method:"POST",body:fd});
  const json = await res.json();

  Swal.close();

  details.innerHTML = `
    <b>Ticket ID:</b> ${ticketId}<br>
    <b>‡∞≠‡∞ï‡±ç‡∞§‡±Å‡∞®‡∞ø ‡∞™‡±á‡∞∞‡±Å:</b> ${name.value}<br>
    <b>‡∞®‡±Ü‡∞≤‡∞≤‡±Å:</b> ${json.months}<br>
    <b>‡∞Æ‡±ä‡∞§‡±ç‡∞§‡∞Ç:</b> ‚Çπ${json.amount}
  `;

  // Generate QR
  document.getElementById("qr").innerHTML="";
  new QRCode(qr,{text:verifyURL,width:160,height:160});

  formCard.style.display="none";
  ticket.style.display="block";
}

/**************************************************
 * Save receipt as image
 **************************************************/
function saveImage(){
  html2canvas(capture,{scale:3}).then(canvas=>{
    const a=document.createElement("a");
    a.href=canvas.toDataURL();
    a.download="Poleramma_Seva_Receipt.png";
    a.click();
  });
}

/**************************************************
 * WhatsApp Share
 **************************************************/
function shareWhatsApp(){
  const msg = `‡∞∂‡±ç‡∞∞‡±Ä ‡∞™‡±ã‡∞≤‡±á‡∞∞‡∞Æ‡±ç‡∞Æ ‡∞§‡∞≤‡±ç‡∞≤‡∞ø ‡∞∏‡±á‡∞µ ‡∞∞‡∞∏‡±Ä‡∞¶‡±Å%0A${details.innerText}`;
  window.open(`https://wa.me/91${mobile.value}?text=${msg}`);
}
</script>

</body>
</html>
