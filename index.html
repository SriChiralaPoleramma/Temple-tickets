<!DOCTYPE html>
<html lang="te">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Premium Pooja Booking - Poleramma Temple</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;800&display=swap');

        :root { 
            --primary-gradient: linear-gradient(135deg, #ff4e50, #f9d423);
            --dark-accent: #bf360c;
            --glass-bg: rgba(255, 255, 255, 0.9);
        }

        body { 
            font-family: 'Poppins', 'Segoe UI', sans-serif; 
            background: #fdf2e9; 
            background-image: radial-gradient(#ffd8b1 1px, transparent 1px);
            background-size: 20px 20px;
            margin: 0; padding-bottom: 50px; 
        }
        
        header { 
            background: var(--primary-gradient); 
            color: white; text-align: center; padding: 50px 20px; 
            border-bottom-left-radius: 80px; border-bottom-right-radius: 80px;
            box-shadow: 0 10px 25px rgba(255, 78, 80, 0.3);
        }

        .main-container { display: flex; flex-direction: column; align-items: center; padding: 0 15px; }
        
        .booking-card { 
            background: var(--glass-bg); padding: 30px; border-radius: 30px; 
            box-shadow: 0 15px 35px rgba(0,0,0,0.1); 
            width: 100%; max-width: 500px; margin-top: -60px;
            backdrop-filter: blur(10px); border: 1px solid white;
        }

        .input-group { margin-bottom: 18px; }
        label { font-weight: 600; color: var(--dark-accent); display: block; margin-bottom: 8px; font-size: 0.85rem; }
        
        input, textarea { 
            width: 100%; padding: 12px 15px; border: 2px solid #eee; 
            border-radius: 12px; font-size: 1rem; transition: 0.3s; box-sizing: border-box;
        }

        input:focus { border-color: #ff4e50; outline: none; box-shadow: 0 0 8px rgba(255,78,80,0.2); }
        
        .date-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }

        .pricing-section {
            background: #fff9c4; padding: 20px; border-radius: 20px; 
            text-align: center; margin: 20px 0; border: 2px dashed #f9d423;
        }

        .submit-btn { 
            width: 100%; background: var(--primary-gradient); color: white; border: none; 
            padding: 18px; border-radius: 15px; font-size: 1.1rem; font-weight: 800;
            cursor: pointer; text-transform: uppercase; letter-spacing: 1px;
            box-shadow: 0 8px 20px rgba(255, 78, 80, 0.4);
        }

        /* TICKET LOOK */
        #ticket-wrapper { width: 100%; max-width: 450px; margin-top: 40px; }
        .receipt-card { 
            background: #fff; border-radius: 25px; position: relative;
            box-shadow: 0 25px 50px rgba(0,0,0,0.15); border-top: 10px solid #ff4e50;
        }
        
        .receipt-header { padding: 30px 20px; text-align: center; border-bottom: 2px dashed #ddd; }
        .receipt-body { padding: 30px; }
        
        .row-item { display: flex; justify-content: space-between; margin-bottom: 12px; border-bottom: 1px solid #f9f9f9; padding-bottom: 6px; }
        .row-item span { color: #777; font-size: 0.85rem; }
        .row-item b { color: #222; font-size: 0.95rem; }

        .qr-area { background: #fdfdfd; padding: 15px; border-radius: 20px; margin: 20px auto; display: block; width: fit-content; border: 1px solid #eee; }
        
        .total-badge { 
            background: #e8f5e9; color: #2e7d32; padding: 15px; text-align: center;
            border-radius: 15px; font-size: 1.5rem; font-weight: 900;
        }

        .btn-actions { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 25px; }
        .action-btn { padding: 15px; border-radius: 15px; border: none; color: white; font-weight: bold; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; }

        .hidden { display: none; }
    </style>
</head>
<body>

<header>
    <h1 style="margin: 0; font-size: 1.8rem;">శ్రీ పోలేరమ్మ తల్లి దేవస్థానం</h1>
    <p style="opacity: 0.9; font-weight: 300;">అధికారిక ఆన్‌లైన్ మాస పూజ బుకింగ్</p>
</header>

<div class="main-container">
    <div class="booking-card" id="form-ui">
        <h2 style="text-align: center; color: var(--dark-accent); margin-bottom: 25px;">పూజా వివరాలు</h2>
        <form id="poojaForm">
            <div class="input-group">
                <label><i class="fas fa-user"></i> భక్తుని పేరు (Name)</label>
                <input type="text" id="name" required placeholder="మీ పేరు">
            </div>

            <div class="date-grid">
                <div class="input-group">
                    <label><i class="fas fa-om"></i> గోత్రం (Gothram)</label>
                    <input type="text" id="gothram" required placeholder="గోత్రం">
                </div>
                <div class="input-group">
                    <label><i class="fas fa-phone"></i> ఫోన్ నంబర్</label>
                    <input type="tel" id="phone" maxlength="10" required placeholder="మొబైల్">
                </div>
            </div>

            <div class="input-group">
                <label><i class="fas fa-users"></i> కుటుంబ సభ్యులు (Family Members)</label>
                <textarea id="family" rows="2" placeholder="పేర్లు మరియు నక్షత్రాలు (ఒకరి తర్వాత ఒకరు)"></textarea>
            </div>

            <div class="date-grid">
                <div class="input-group">
                    <label><i class="fas fa-calendar-alt"></i> ప్రారంభ తేదీ</label>
                    <input type="date" id="start" required>
                </div>
                <div class="input-group">
                    <label><i class="fas fa-calendar-check"></i> ముగింపు తేదీ</label>
                    <input type="date" id="end" required>
                </div>
            </div>

            <div class="pricing-section">
                <p style="margin:0; color:#856404; font-weight:600;">మొత్తం చెల్లించవలసిన రుసుము</p>
                <div id="priceDisplay" style="font-size: 2.2rem; font-weight: 800; color: #bf360c;">₹0</div>
            </div>

            <button type="submit" class="submit-btn">Generate Premium Ticket</button>
        </form>
    </div>

    <div id="ticket-wrapper" class="hidden">
        <div id="ticket-capture" class="receipt-card">
            <div class="receipt-header">
                <img src="https://cdn-icons-png.flaticon.com/512/2867/2867866.png" width="50" style="margin-bottom: 10px;">
                <h2 style="margin:0; color:var(--dark-accent); font-size: 1.4rem;">పూజా ప్రసాద రశీదు</h2>
                <span id="txnId" style="font-size: 0.75rem; color: #999; letter-spacing: 1px;"></span>
            </div>
            <div class="receipt-body">
                <div class="row-item"><span>పేరు:</span> <b id="r-name"></b></div>
                <div class="row-item"><span>గోత్రం:</span> <b id="r-gothram"></b></div>
                <div class="row-item"><span>ఫోన్:</span> <b id="r-phone"></b></div>
                <div class="row-item" style="flex-direction: column; border: none; align-items: flex-start;">
                    <span>కుటుంబ సభ్యులు:</span>
                    <b id="r-family" style="margin-top: 5px; line-height: 1.4; color: #444;"></b>
                </div>
                <hr style="border:0; border-top: 1px dashed #eee; margin: 15px 0;">
                <div class="row-item"><span>వ్యవధి:</span> <b id="r-dates"></b></div>
                
                <div class="qr-area" id="qr"></div>
                
                <div class="total-badge">₹<span id="r-total"></span></div>
                <p style="text-align: center; color: #bbb; font-size: 10px; margin-top: 15px; font-weight: bold;">OFFICIALLY VERIFIED DIGITAL RECEIPT</p>
            </div>
        </div>

        <div class="btn-actions">
            <button onclick="saveTicket()" class="action-btn" style="background: #1565c0;"><i class="fas fa-file-download"></i> Save PNG</button>
            <button onclick="location.reload()" class="action-btn" style="background: #e65100;"><i class="fas fa-redo"></i> New Booking</button>
        </div>
    </div>
</div>

<script>
    const startInput = document.getElementById('start');
    const endInput = document.getElementById('end');

    function calculateTotal() {
        if(startInput.value && endInput.value) {
            const d1 = new Date(startInput.value);
            const d2 = new Date(endInput.value);
            let months = (d2.getFullYear() - d1.getFullYear()) * 12 + (d2.getMonth() - d1.getMonth()) + 1;
            if (months < 1) months = 0;
            document.getElementById('priceDisplay').innerText = `₹${months * 100}`;
            return { total: months * 100, count: months };
        }
        return { total: 0, count: 0 };
    }

    [startInput, endInput].forEach(el => el.addEventListener('change', calculateTotal));

    document.getElementById('poojaForm').addEventListener('submit', function(e) {
        e.preventDefault();
        const info = calculateTotal();
        if(info.count <= 0) {
            Swal.fire("Error", "తేదీలను సరిగ్గా ఎంచుకోండి", "error");
            return;
        }

        const tid = "TKT-" + Math.floor(Math.random() * 899999 + 100000);
        const name = document.getElementById('name').value;
        const gothram = document.getElementById('gothram').value;
        const family = document.getElementById('family').value || "None";

        // Set Ticket Values
        document.getElementById('txnId').innerText = "ID: " + tid;
        document.getElementById('r-name').innerText = name;
        document.getElementById('r-gothram').innerText = gothram;
        document.getElementById('r-phone').innerText = document.getElementById('phone').value;
        document.getElementById('r-family').innerText = family;
        document.getElementById('r-dates').innerText = `${startInput.value} నుండి ${endInput.value}`;
        document.getElementById('r-total').innerText = info.total;

        // QR Code Logic
        const currentUrl = window.location.href.split('?')[0];
        const vUrl = `${currentUrl}?v=true&id=${tid}&n=${encodeURIComponent(name)}&g=${encodeURIComponent(gothram)}&f=${encodeURIComponent(family)}&s=${startInput.value}&e=${endInput.value}&t=${info.total}`;

        document.getElementById('qr').innerHTML = "";
        new QRCode(document.getElementById('qr'), { text: vUrl, width: 150, height: 150 });

        document.getElementById('form-ui').classList.add('hidden');
        document.getElementById('ticket-wrapper').classList.remove('hidden');
        window.scrollTo(0, 0);
    });

    // Verification Logic from URL
    window.onload = function() {
        const p = new URLSearchParams(window.location.search);
        if (p.has('v')) {
            document.getElementById('r-name').innerText = p.get('n');
            document.getElementById('r-gothram').innerText = p.get('g');
            document.getElementById('r-family').innerText = p.get('f');
            document.getElementById('r-dates').innerText = `${p.get('s')} నుండి ${p.get('e')}`;
            document.getElementById('r-total').innerText = p.get('t');
            document.getElementById('txnId').innerText = "VERIFIED ID: " + p.get('id');
            document.getElementById('r-phone').innerText = "Hidden for Safety";
            
            document.getElementById('form-ui').classList.add('hidden');
            document.getElementById('ticket-wrapper').classList.remove('hidden');
            document.querySelector('.btn-actions').classList.add('hidden');
            document.getElementById('qr').classList.add('hidden');
            Swal.fire("Verified!","పోలేరమ్మ తల్లి దేవస్థానం పూజా రశీదు.", "success");
        }
    };

    function saveTicket() {
        html2canvas(document.getElementById('ticket-capture'), { scale: 3 }).then(canvas => {
            const link = document.createElement('a');
            link.download = `Pooja_Ticket_${Date.now()}.png`;
            link.href = canvas.toDataURL();
            link.click();
        });
    }
</script>
</body>
    </html>
                                                              
