<!DOCTYPE html>
<html lang="te">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>శ్రీ పోలేరమ్మ తల్లి | Seva Portal</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <style>
        :root { --primary: #bf360c; --glass: rgba(255, 255, 255, 0.95); --bg: #fdf5e6; }
        body { font-family: 'Segoe UI', system-ui, sans-serif; background: var(--bg); margin: 0; }
        header { background: linear-gradient(135deg, #880e4f, #bf360c); color: white; padding: 50px 20px; text-align: center; border-bottom-right-radius: 50px; border-bottom-left-radius: 50px; }
        .container { max-width: 450px; margin: -40px auto 40px; padding: 20px; }
        .card { background: var(--glass); padding: 25px; border-radius: 30px; box-shadow: 0 15px 35px rgba(0,0,0,0.1); border: 1px solid white; }
        .input-group { margin-bottom: 15px; }
        label { font-size: 12px; font-weight: bold; color: #666; display: block; margin-bottom: 5px; }
        input, textarea { width: 100%; padding: 12px; border: 2px solid #eee; border-radius: 12px; box-sizing: border-box; }
        .btn { width: 100%; padding: 15px; border-radius: 12px; border: none; color: white; font-weight: bold; cursor: pointer; margin-top: 10px; }
        .btn-main { background: var(--primary); }
        .ticket { background: white; padding: 20px; border-radius: 20px; border: 2px solid #f0f0f0; }
        .qr-box { display: flex; justify-content: center; margin: 20px 0; }
        .hidden { display: none; }
    </style>
</head>
<body>

<header>
    <h1>శ్రీ పోలేరమ్మ తల్లి</h1>
    <p>Smart Digital Seva Portal</p>
</header>

<div class="container">
    <div id="formSection" class="card">
        <form id="bookingForm">
            <div class="input-group"><label>భక్తుని పేరు</label><input type="text" id="name" required></div>
            <div class="input-group"><label>మొబైల్ నంబర్</label><input type="tel" id="phone" required maxlength="10"></div>
            <div class="input-group"><label>గోత్రం</label><input type="text" id="gothram"></div>
            <div class="input-group"><label>కుటుంబ సభ్యులు</label><textarea id="family"></textarea></div>
            <div style="display: flex; gap: 10px;">
                <div class="input-group"><label>ప్రారంభ తేదీ</label><input type="date" id="sDate" required></div>
                <div class="input-group"><label>ముగింపు తేదీ</label><input type="date" id="eDate" required disabled></div>
            </div>
            <div style="text-align: center; padding: 15px; background: #fff8e1; border-radius: 15px; border: 1px dashed orange;">
                <h2 id="totalPrice" style="margin:0; color:var(--primary);">₹0</h2>
                <small id="monthText">0 Months Selected</small>
            </div>
            <button type="submit" class="btn btn-main">Generate Receipt & Save</button>
        </form>
    </div>

    <div id="receiptSection" class="card hidden">
        <div id="captureArea" class="ticket">
            <div style="text-align: center; border-bottom: 2px solid #f0f0f0; padding-bottom: 10px;">
                <h3 style="margin:0; color:#880e4f;">POOJA RECEIPT</h3>
                <small id="t-id" style="font-weight: bold;"></small>
            </div>
            <p><b>Name:</b> <span id="t-name"></span></p>
            <p><b>Dates:</b> <span id="t-period"></span></p>
            <div class="qr-box"><div id="qrcode"></div></div>
            <div style="text-align: center; background: #e8f5e9; padding: 10px; border-radius: 10px;">
                <h3 style="margin:0; color:green;">Amount Paid: ₹<span id="t-amt"></span></h3>
            </div>
        </div>
        <button onclick="downloadImg()" class="btn" style="background:#34495e;">Download Image</button>
        <button onclick="location.reload()" class="btn btn-main">Book New</button>
    </div>
</div>

<script>
    // Paste your Google Web App URL here
    const SCRIPT_URL = "YOUR_DEPLOYED_WEB_APP_URL_HERE";

    const sDate = document.getElementById('sDate');
    const eDate = document.getElementById('eDate');
    
    sDate.min = new Date().toISOString().split('T')[0];
    sDate.onchange = () => { eDate.disabled = false; eDate.min = sDate.value; updatePrice(); };
    eDate.onchange = updatePrice;

    function updatePrice() {
        if(sDate.value && eDate.value) {
            let start = new Date(sDate.value);
            let end = new Date(eDate.value);
            let months = (end.getFullYear() - start.getFullYear()) * 12 + (end.getMonth() - start.getMonth());
            if (end.getDate() < start.getDate()) months--;
            const count = Math.max(0, months);
            document.getElementById('totalPrice').innerText = "₹" + (count * 100);
            document.getElementById('monthText').innerText = count + " Month(s) Calculated";
            return count;
        }
        return 0;
    }

    document.getElementById('bookingForm').onsubmit = async (e) => {
        e.preventDefault();
        const months = updatePrice();
        if(months < 1) return Swal.fire("Warning", "Min 1 month required", "warning");

        Swal.fire({ title: 'Processing...', allowOutsideClick: false, didOpen: () => Swal.showLoading() });

        const tid = "POL-" + Math.random().toString(36).substr(2, 6).toUpperCase();
        const data = {
            tid: tid,
            name: document.getElementById('name').value,
            phone: document.getElementById('phone').value,
            gothram: document.getElementById('gothram').value || "---",
            family: document.getElementById('family').value || "---",
            startDate: sDate.value,
            endDate: eDate.value,
            amount: months * 100
        };

        try {
            await fetch(SCRIPT_URL, { method: 'POST', mode: 'no-cors', body: JSON.stringify(data) });
            
            // Show Receipt
            document.getElementById('t-id').innerText = tid;
            document.getElementById('t-name').innerText = data.name;
            document.getElementById('t-period').innerText = data.startDate + " to " + data.endDate;
            document.getElementById('t-amt').innerText = data.amount;
            
            document.getElementById('qrcode').innerHTML = "";
            new QRCode(document.getElementById('qrcode'), { text: tid, width: 128, height: 128 });

            document.getElementById('formSection').classList.add('hidden');
            document.getElementById('receiptSection').classList.remove('hidden');
            Swal.close();
        } catch (err) {
            Swal.fire("Error", "Check your Internet/URL", "error");
        }
    };

    function downloadImg() {
        html2canvas(document.getElementById('captureArea')).then(canvas => {
            let a = document.createElement('a');
            a.download = "Receipt.png";
            a.href = canvas.toDataURL();
            a.click();
        });
    }
</script>
</body>
                    </html>
                    
