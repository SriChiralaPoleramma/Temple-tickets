<!DOCTYPE html>
<html lang="te">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pooja Booking - Poleramma Temple</title>
    <link rel="stylesheet" href="booking.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body>

<header>
    <div class="logo-container">
        <img src="templeimage/1742626228036 (1).jpg" alt="Logo" class="header-logo">
        <h1>‡∞∂‡±ç‡∞∞‡±Ä ‡∞∂‡±ç‡∞∞‡±Ä ‡∞∂‡±ç‡∞∞‡±Ä ‡∞ö‡±Ä‡∞∞‡∞æ‡∞≤ ‡∞™‡±ã‡∞≤‡±á‡∞∞‡∞Æ‡±ç‡∞Æ ‡∞§‡∞≤‡±ç‡∞≤‡∞ø ‡∞¶‡±á‡∞µ‡∞∏‡±ç‡∞•‡∞æ‡∞®‡∞Ç</h1>
    </div>
</header>

<section class="booking-container">
    <div class="booking-form">
        <h2>üìú ‡∞™‡±Ç‡∞ú‡∞æ ‡∞¨‡±Å‡∞ï‡∞ø‡∞Ç‡∞ó‡±ç</h2>
        <form id="monthlyForm">
            <label>üë§ ‡∞™‡±á‡∞∞‡±Å</label>
            <input type="text" id="name" required placeholder="‡∞Æ‡±Ä ‡∞™‡±á‡∞∞‡±Å">

            <label>üìû ‡∞´‡±ã‡∞®‡±ç ‡∞®‡∞Ç‡∞¨‡∞∞‡±ç</label>
            <input type="tel" id="phone" required placeholder="10 ‡∞Ö‡∞Ç‡∞ï‡±Ü‡∞≤ ‡∞®‡∞Ç‡∞¨‡∞∞‡±ç" maxlength="10">

            <label>üïâÔ∏è ‡∞ó‡±ã‡∞§‡±ç‡∞∞‡∞Ç</label>
            <input type="text" id="gothram" required placeholder="‡∞â‡∞¶‡∞æ: ‡∞µ‡∞æ‡∞∏‡∞ø‡∞∑‡±ç‡∞†">

            <label>üë™ ‡∞ï‡±Å‡∞ü‡±Å‡∞Ç‡∞¨ ‡∞∏‡∞≠‡±ç‡∞Ø‡±Å‡∞≤‡±Å</label>
            <textarea id="family" rows="2" placeholder="‡∞∞‡∞æ‡∞Æ‡±Å, ‡∞∏‡±Ä‡∞§, ‡∞≤‡∞ï‡±ç‡∞∑‡±ç‡∞Æ‡∞ø"></textarea>

            <div class="row">
                <div class="col">
                    <label>üìÖ ‡∞™‡±ç‡∞∞‡∞æ‡∞∞‡∞Ç‡∞≠ ‡∞§‡±á‡∞¶‡±Ä</label>
                    <input type="date" id="startDate" required>
                </div>
                <div class="col">
                    <label>üìÖ ‡∞Æ‡±Å‡∞ó‡∞ø‡∞Ç‡∞™‡±Å ‡∞§‡±á‡∞¶‡±Ä</label>
                    <input type="date" id="endDate" required>
                </div>
            </div>

            <div id="priceSummary" class="price-summary-card">
                <p id="dayCount">‡∞∞‡±ã‡∞ú‡±Å‡∞≤ ‡∞∏‡∞Ç‡∞ñ‡±ç‡∞Ø: 0</p>
                <h3 id="totalCost">‡∞Æ‡±ä‡∞§‡±ç‡∞§‡∞Ç: ‚Çπ0</h3>
            </div>

            <button type="submit" class="monthly-btn">üõï ‡∞¨‡±Å‡∞ï‡±ç ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø</button>
        </form>
    </div>

    <section id="ticketOutput" class="hidden">
        <div class="ticket-card" id="printableTicket">
            <div class="ticket-header">
                <img src="templeimage/1742626228036 (1).jpg" alt="Logo" class="ticket-logo">
                <h3>‡∞ü‡∞ø‡∞ï‡±Ü‡∞ü‡±ç ‡∞¨‡±Å‡∞ï‡∞ø‡∞Ç‡∞ó‡±ç ‡∞®‡∞ø‡∞∞‡±ç‡∞ß‡∞æ‡∞∞‡∞£</h3>
            </div>
            <div class="ticket-body">
                <div class="t-row"><span>ID:</span> <b id="t-id"></b></div>
                <div class="t-row"><span>‡∞¨‡±Å‡∞ï‡∞ø‡∞Ç‡∞ó‡±ç ‡∞§‡±á‡∞¶‡±Ä:</span> <span id="t-date"></span></div>
                <hr>
                <div class="t-row"><span>‡∞™‡±á‡∞∞‡±Å:</span> <span id="t-name"></span></div>
                <div class="t-row"><span>‡∞ó‡±ã‡∞§‡±ç‡∞∞‡∞Ç:</span> <b id="t-gothram"></b></div>
                <div class="t-row"><span>‡∞´‡±ã‡∞®‡±ç:</span> <span id="t-phone"></span></div>
                <div class="t-row"><span>‡∞™‡±ç‡∞∞‡∞æ‡∞∞‡∞Ç‡∞≠ ‡∞§‡±á‡∞¶‡±Ä:</span> <span id="t-start"></span></div>
                <div class="t-row"><span>‡∞Æ‡±Å‡∞ó‡∞ø‡∞Ç‡∞™‡±Å ‡∞§‡±á‡∞¶‡±Ä:</span> <span id="t-end"></span></div>
                
                <div class="price-highlight">
                    üí∞ ‡∞Æ‡±ä‡∞§‡±ç‡∞§‡∞Ç ‡∞ö‡±Ü‡∞≤‡±ç‡∞≤‡∞ø‡∞Ç‡∞™‡±Å: <b>‚Çπ<span id="t-total"></span></b>
                </div>
                <div class="paid-stamp">PAID</div>
            </div>
            <div class="ticket-actions">
                <button onclick="window.print()" class="btn-print">üñ®Ô∏è Print</button>
                <button onclick="shareWhatsApp()" class="btn-wa">üì± WhatsApp</button>
                <button onclick="shareMessage()" class="btn-msg">üîó Share</button>
            </div>
        </div>
    </section>
</section>

<div id="spinner" class="spinner hidden"></div>

<script>
const SCRIPT_URL = "PASTE_YOUR_APPSCRIPT_URL_HERE";
const form = document.getElementById('monthlyForm');
let bookingData = {};

// 1. Dynamic Price Calculator (Based on Days)
function updatePrice() {
    const start = document.getElementById('startDate').value;
    const end = document.getElementById('endDate').value;
    if (start && end) {
        const d1 = new Date(start);
        const d2 = new Date(end);
        const diffTime = d2 - d1;
        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)) + 1; 

        if (diffDays > 0) {
            document.getElementById('dayCount').innerText = `‡∞∞‡±ã‡∞ú‡±Å‡∞≤ ‡∞∏‡∞Ç‡∞ñ‡±ç‡∞Ø: ${diffDays}`;
            // Assuming 100 per day for this example, adjust math as needed
            document.getElementById('totalCost').innerText = `‡∞Æ‡±ä‡∞§‡±ç‡∞§‡∞Ç: ‚Çπ${diffDays * 100}`;
            return { total: diffDays * 100, count: diffDays };
        }
    }
    return { total: 0, count: 0 };
}

document.getElementById('startDate').addEventListener('change', updatePrice);
document.getElementById('endDate').addEventListener('change', updatePrice);

// 2. Form Submission
form.addEventListener('submit', async (e) => {
    e.preventDefault();
    const { total, count } = updatePrice();
    if (total <= 0) return Swal.fire("Error", "‡∞§‡±á‡∞¶‡±Ä‡∞≤‡±Å ‡∞∏‡∞∞‡∞ø‡∞ó‡±ç‡∞ó‡∞æ ‡∞é‡∞Ç‡∞ö‡±Å‡∞ï‡±ã‡∞Ç‡∞°‡∞ø", "error");

    document.getElementById('spinner').classList.remove('hidden');
    
    bookingData = {
        bookingID: "POL-" + Date.now().toString().slice(-6),
        name: document.getElementById('name').value,
        phone: document.getElementById('phone').value,
        gothram: document.getElementById('gothram').value,
        family: document.getElementById('family').value || 'N/A',
        startDate: document.getElementById('startDate').value,
        endDate: document.getElementById('endDate').value,
        totalAmount: total,
        bookingDate: new Date().toLocaleString('en-IN')
    };

    const formData = new FormData();
    for (let key in bookingData) formData.append(key, bookingData[key]);

    try {
        await fetch(SCRIPT_URL, { method: 'POST', body: formData });
        document.getElementById('spinner').classList.add('hidden');
        Swal.fire("‡∞µ‡∞ø‡∞ú‡∞Ø‡∞Ç!", "‡∞¨‡±Å‡∞ï‡∞ø‡∞Ç‡∞ó‡±ç ‡∞µ‡∞ø‡∞ú‡∞Ø‡∞µ‡∞Ç‡∞§‡∞Æ‡±à‡∞Ç‡∞¶‡∞ø", "success");
        
        // Show Ticket with New Fields
        document.getElementById('t-id').innerText = bookingData.bookingID;
        document.getElementById('t-date').innerText = bookingData.bookingDate;
        document.getElementById('t-name').innerText = bookingData.name;
        document.getElementById('t-gothram').innerText = bookingData.gothram;
        document.getElementById('t-phone').innerText = bookingData.phone;
        document.getElementById('t-start').innerText = bookingData.startDate;
        document.getElementById('t-end').innerText = bookingData.endDate;
        document.getElementById('t-total').innerText = total;
        
        document.getElementById('ticketOutput').classList.remove('hidden');
        window.scrollTo(0, document.body.scrollHeight);
    } catch (err) {
        document.getElementById('spinner').classList.add('hidden');
        Swal.fire("Error", "‡∞∏‡∞∞‡±ç‡∞µ‡∞∞‡±ç ‡∞∏‡∞Æ‡∞∏‡±ç‡∞Ø ‡∞è‡∞∞‡±ç‡∞™‡∞°‡∞ø‡∞Ç‡∞¶‡∞ø", "error");
    }
});

// 3. Sharing Features
function shareWhatsApp() {
    const text = `*‡∞∂‡±ç‡∞∞‡±Ä ‡∞™‡±ã‡∞≤‡±á‡∞∞‡∞Æ‡±ç‡∞Æ ‡∞Ü‡∞≤‡∞Ø ‡∞ü‡∞ø‡∞ï‡±Ü‡∞ü‡±ç*%0Aüîñ ID: ${bookingData.bookingID}%0Aüë§ ‡∞™‡±á‡∞∞‡±Å: ${bookingData.name}%0AüïâÔ∏è ‡∞ó‡±ã‡∞§‡±ç‡∞∞‡∞Ç: ${bookingData.gothram}%0AüìÖ ‡∞™‡±ç‡∞∞‡∞æ‡∞∞‡∞Ç‡∞≠‡∞Ç: ${bookingData.startDate}%0AüìÖ ‡∞Æ‡±Å‡∞ó‡∞ø‡∞Ç‡∞™‡±Å: ${bookingData.endDate}%0Aüí∞ ‡∞Æ‡±ä‡∞§‡±ç‡∞§‡∞Ç: ‚Çπ${bookingData.totalAmount}%0A‚úÖ Status: PAID`;
    window.open(`https://wa.me/91${bookingData.phone}?text=${text}`, '_blank');
}

function shareMessage() {
    const text = `Poleramma Temple: ID ${bookingData.bookingID}, Name: ${bookingData.name}, Gothram: ${bookingData.gothram}, From ${bookingData.startDate} to ${bookingData.endDate} is Confirmed.`;
    if (navigator.share) {
        navigator.share({ title: 'Temple Ticket', text: text });
    } else {
        alert(text);
    }
}
</script>

<style>
body { font-family: sans-serif; background: #fdf5e6; margin: 0; }
header { background: #e65100; color: white; text-align: center; padding: 10px; }
.header-logo { width: 50px; border-radius: 50%; }
.booking-container { display: flex; flex-direction: column; align-items: center; padding: 20px; }
.booking-form { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); width: 100%; max-width: 400px; }
.row { display: flex; gap: 10px; }
.col { flex: 1; }
input, textarea { width: 100%; padding: 10px; margin: 8px 0; border: 1px solid #ccc; border-radius: 5px; box-sizing: border-box; }
.price-summary-card { background: #fff3e0; padding: 10px; margin: 10px 0; border-radius: 5px; text-align: center; border-left: 5px solid #ff9800; }
.monthly-btn { width: 100%; background: #e65100; color: white; border: none; padding: 12px; border-radius: 20px; font-weight: bold; cursor: pointer; }

/* TICKET STYLES */
.ticket-card { background: white; border: 2px dashed #8d6e63; padding: 20px; border-radius: 15px; margin-top: 20px; width: 100%; max-width: 400px; position: relative; }
.ticket-logo { width: 50px; display: block; margin: 0 auto; }
.t-row { display: flex; justify-content: space-between; margin: 5px 0; font-size: 14px; }
.price-highlight { background: #e8f5e9; padding: 10px; text-align: center; color: #2e7d32; border-radius: 5px; margin-top: 10px; border: 1px solid #c8e6c9; }
.paid-stamp { position: absolute; bottom: 100px; right: 20px; border: 3px double #d32f2f; color: #d32f2f; font-weight: bold; padding: 5px; transform: rotate(-15deg); opacity: 0.5; }
.ticket-actions { display: flex; gap: 5px; margin-top: 15px; justify-content: center; }
.btn-print, .btn-wa, .btn-msg { padding: 8px 12px; border: none; border-radius: 5px; color: white; cursor: pointer; font-size: 12px; }
.btn-print { background: #555; } .btn-wa { background: #25d366; } .btn-msg { background: #007bff; }
.hidden { display: none; }
.spinner { position: fixed; top: 50%; left: 50%; width: 40px; height: 40px; border: 4px solid #f3f3f3; border-top: 4px solid #ff9800; border-radius: 50%; animation: spin 1s linear infinite; }

/* Print Media Query */
@media print {
    body * { visibility: hidden; }
    #printableTicket, #printableTicket * { visibility: visible; }
    #printableTicket { position: absolute; left: 0; top: 0; width: 100%; border: none; }
    .ticket-actions { display: none; }
}
@keyframes spin { to { transform: rotate(360deg); } }
</style>
</body>
  </html>
  
